# Food For All DC - Cursor Rules

## Code Quality Principles
- Always follow good code standards and best practices
- Prefer minimal implementations - avoid over-engineering
- Reuse code when possible (DRY principle - clean code)
- Don't add obvious comments - code should be self-documenting
- Extract reusable logic into utilities, hooks, or services
- Keep functions small and focused on a single responsibility

## Architecture Patterns

### Services (Singleton Pattern)
- Use `Service.getInstance()` pattern
- Key services: `ClientService`, `DeliveryService`, `DriverService`, `ClusterService`, `AuthUserService`
- Always use `formatServiceError()` for error handling
- Use `retry()` utility for operations that may fail

### State Management
- Global: React Context (`AuthProvider`, `ClientDataContext`, `RecurringDeliveryContext`)
- Local: Component state for forms/UI
- Always refresh context after mutations

### Routing
- Routes in `src/routesConfig.tsx`
- Use `ProtectedRoute` for role-based access (Admin, Manager, ClientIntake, Driver)
- Lazy load page components (except login/forgot-password)

## Code Style

### TypeScript
- Use types from `src/types/`
- Prefer interfaces over types for object shapes

### Styling
- CSS Modules (`.module.css`) for component styles
- CSS variables from `src/styles/theme.css` - never hardcode colors/spacing
- Use common components (`Button`, `Input`, `Modal`) from `src/components/common/`

### Naming
- Components: PascalCase (`ClientProfile.tsx`)
- Hooks: `use` prefix (`useClientData`)
- Services: `Service` suffix (`ClientService`)

## Firebase

### Collections
- `client-profile2`, `events`, `users`, `Drivers2`, `clusters`, `referral`, `limits`, `tags`

### Operations
- Use lazy initialization in `firebaseConfig.ts`
- Validate with `firestoreValidation` before writes
- Wrap errors with `formatServiceError()`
- Show errors via `NotificationProvider`

## Common Workflows

### Adding a Page
1. Create in `src/pages/`
2. Add route to `routesConfig.tsx`
3. Add nav link in `BasePage.tsx`
4. Use context hooks and services

### Modifying Client Data
1. Update type in `src/types/client-types.ts`
2. Update form components
3. Add to `firestoreValidation.ts`
4. Update Spreadsheet/export logic

### Schema Changes
1. Update types first
2. Update validation schemas
3. Update services and forms

## Performance
- Lazy load pages, memoize heavy components
- Virtual scrolling for large lists (3000+ items)
- Cache roles (5 min), recurring deliveries

